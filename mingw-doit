PATH=/target/bin:${PATH}
export PATH
set -x
#
# Configure system
./configure

#
# intl directory needs a config.h, not sure why
# cp config.h src
# config.h is generated by configure, don't do a touch on it.
# touch config.h

#
# Build a MINGW32 version of libltdl
cd libltdl
gcc -mno-cygwin -fnative-struct -D__WINDOWS__ -DHAVE_CONFIG_H -I. -I. -I.     -g -O2 -c ltdl.c
cd ..

#
# Build Ayttm in full... Note, to make this work I have in /target/bin
# a dummy copy of aclocal, automake, and autoconf. THey just echo. Cygwin
# does not have versions for MINGW32 and since GLIB/GTK comes from 
# www.gimp.org/win32 and is in /target this is what you need to make it
# work.
make $*
if [ $? != 0 ]; then exit; fi

#
# not ready for DLLs?
if [ X"$*" = X"all" ]
then
	exit
fi

#
# Make all DLLs for MINGW32
if [ X"$*" != X"clean" ]
then
	
	#
	# rebuild eb for DLL linkage
	./makeebdll

	#
	# rebuild all plugins as DLLs.
	cd modules/importers
        for x in import_gaim import_gnomeicu importicq importlicq smileysc smileys2
	do
                ../../makedll $x gcc
		cp $x.dll /cygdrive/c/.ayttm/modules
		cp $x.dll /cygdrive/c/.ayttm/modules/.libs
	done
        cd ../utility
        for x in middle rainbow autotrans
        do
                ../../makedll $x gcc
                cp $x.dll /cygdrive/c/.ayttm/modules
                cp $x.dll /cygdrive/c/.ayttm/modules/.libs
        done
	cd ../aim-toc
        ../../makedll aim-toc gcc libtoc/libtoc.o
	cp aim-toc.dll /cygdrive/c/.ayttm/modules
	cp aim-toc.dll /cygdrive/c/.ayttm/modules/.libs
        cd ../icq
        ../../makedll icq gcc libicq/*.o
        cp icq.dll /cygdrive/c/.ayttm/modules
        cp icq.dll /cygdrive/c/.ayttm/modules/.libs
        cd ../yahoo2
        ../../makedll yahoo gcc libyahoo2/*.o
        cp yahoo.dll /cygdrive/c/.ayttm/modules
        cp yahoo.dll /cygdrive/c/.ayttm/modules/.libs
        cd ../irc
        ../../makedll irc gcc
        cp irc.dll /cygdrive/c/.ayttm/modules
        cp irc.dll /cygdrive/c/.ayttm/modules/.libs
	cd ../msn2
	../../makedll msn c++ libmsn2/*.o
        cp msn.dll /cygdrive/c/.ayttm/modules
        cp msn.dll /cygdrive/c/.ayttm/modules/.libs
	cd ../jabber
	../../makedll jabber gcc libEBjabber.o libjabber/*.o libxode/*.o
        cp jabber.dll /cygdrive/c/.ayttm/modules
        cp jabber.dll /cygdrive/c/.ayttm/modules/.libs
fi
